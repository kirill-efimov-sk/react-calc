var elemClassDel="";var param=false;var story=Array();var pattern=/[0-9]/;var patternNew=/\*|\+|\-|\/|×|÷/;var patternNan=/\*|\/|/;var patternDot=/\./;var inputElem=document.querySelector("input");var newElem=document.querySelectorAll("button");document.addEventListener("keydown",function attach(e){var val=e.key;if(patternNew.test(val)){param=false}if((patternNew.test(val)||val=="."&&val!=="="||val=="Enter"||val.match(/CE|Backspace|C|c|С|с/)||pattern.test(val))&&val.includes("F")==false){main(val.replace("Enter","=").replace("Backspace","CE").replace("С","C").replace("с","C").replace("c","C"))}document.removeEventListener("click",attach,false)});document.onclick=function(event){var path=event||event.composedPath&&event.composedPath();try{var elem=path.path[0];var val=elem.innerText}catch{var elem=path.rangeParent.data;var val=elem}if(patternNew.test(val)==true||val=="."){param=false}if(val!=="history"&&elem.tagName!=="DIV"&&elem.tagName!=="INPUT"){main(val)}};function hoverWork(w){if(w==true){elemClassDel.remove("active")}else{elemClassDel.add("unhover")}}function err(oldValue){inputElem.classList.remove("font-micro");inputElem.value=oldValue}function main(value){var operation=inputElem.value;var storyElem=document.getElementsByClassName("history");font(inputElem);for(i=0;i<19;i++){var y=newElem[i].innerText;newElem[i].classList.remove("active");newElem[i].classList.remove("unhover");if(y==value||y.replace("×","*")==value||y.replace("÷","/")==value){newElem[i].classList.add("active");elemClassDel=newElem[i].classList;setTimeout(hoverWork,100,true);setTimeout(hoverWork,150,false)}}if(value.match(/=|Enter/)){try{if(patternNew.test(inputElem.value)){if(inputElem.value!==""){if(!inputElem.value.includes("÷0")){if(patternDot.test(inputElem.value.slice(-1))){inputElem.value=eval(operation.replace("÷","/").replace("×","*")).toFixed(5)}else{inputElem.value=eval(operation.replace("÷","/").replace("×","*"))}font(inputElem);story.push(operation.replace("÷","/").replace("×","*")+"="+inputElem.value)}else{var oldValue=inputElem.value;inputElem.classList.add("font-micro");inputElem.value="недопустимая операция";setTimeout(err,750,oldValue)}if(story.length>2){storyElem[0].textContent=story[2];story.length=0}else if(story.length==1){storyElem[0].textContent=storyElem[0].textContent+", "+story;var checkParam=storyElem[0].textContent.slice(0,1);if(checkParam==","){storyElem[0].textContent=storyElem[0].textContent.replace(",","")}}else{storyElem[0].textContent=story}}else{inputElem.value=""}param=true}else{return false}}catch{inputElem.value=inputElem.value}}else if(value.match(/C|c|С|с/)&&value!=="CE"){story=[];inputElem.value="";storyElem[0].textContent=story;inputElem.classList.remove("font-micro");inputElem.classList.remove("font-min")}else if(value.match(/CE|Backspace/)){inputElem.value=operation.substring(0,operation.length-1);font(inputElem)}else{var arrayStr=inputElem.value.split("");var arrayLen=arrayStr.length;var indexes=[];if(arrayLen>0){var indexSbtrY=arrayStr.indexOf("-");while(indexSbtrY!=-1){indexes.push(indexSbtrY);indexSbtrY=arrayStr.indexOf("-",indexSbtrY+1)}var indexSbtrP=arrayStr.indexOf("+");while(indexSbtrP!=-1){indexes.push(indexSbtrP);indexSbtrP=arrayStr.indexOf("+",indexSbtrP+1)}for(i=0;i<indexes.length;i++){var firstNumber=indexes[0];var secondNumber=indexes[i];var endNumber=firstNumber;if(firstNumber<secondNumber){endNumber=secondNumber}}}if(!pattern.test(value)&&inputElem.value==""){inputElem.value="0"+value;return false}if(param==true){if(value=="±"){if(arrayLen>2&&endNumber!==undefined&&endNumber!==0){if(arrayStr[endNumber].includes("-")){arrayStr.splice(endNumber,1,"+");inputElem.value=arrayStr.join("")}else if(arrayStr[endNumber].includes("+")){arrayStr.splice(endNumber,1,"-");inputElem.value=arrayStr.join("")}}else{if(inputElem.value.includes("-")){inputElem.value=inputElem.value.replace("-","")}else if(inputElem.value.includes("+")){inputElem.value=inputElem.value.replace("+","-")}else{inputElem.value=-inputElem.value}}}else{if(inputElem.value.length>0){inputElem.value+=value.replace("/","÷").replace("*","×")}else{inputElem.value=value.replace("/","÷").replace("*","×")}}param=false}else{if(value=="±"){if(arrayLen>2&&endNumber!==undefined&&endNumber!==0){if(arrayStr[endNumber].includes("-")){arrayStr.splice(endNumber,1,"+");inputElem.value=arrayStr.join("")}else if(arrayStr[endNumber].includes("+")){arrayStr.splice(endNumber,1,"-");inputElem.value=arrayStr.join("")}}else{if(inputElem.value.includes("-")){inputElem.value=inputElem.value.replace("-","")}else if(inputElem.value.includes("+")){inputElem.value=inputElem.value.replace("+","-")}else if(!inputElem.value.includes("÷")&&!inputElem.value.includes("×")){inputElem.value=-inputElem.value}}}else{var strElem=inputElem.value.slice(-1);var strLength=inputElem.value.length;if(patternNew.test(inputElem.value.slice(-1))||patternDot.test(inputElem.value.slice(-1))){var subStr=value.replace("÷","/").replace("×","*");if(pattern.test(subStr)==false){var str=inputElem.value.slice(0,strLength-1)+inputElem.value.slice(-1).replace(strElem,value);inputElem.value=str}else{inputElem.value+=value.replace("/","÷").replace("*","×")}}else if(patternDot.test(inputElem.value.slice(-1))&&value=="."){return false}else{if(patternDot.test(inputElem.value.slice(-1))){inputElem.value=value}else{if(inputElem.value=="0"&&patternDot.test(inputElem.value.slice(-1))){inputElem.value=value}else{inputElem.value+=value.replace("/","÷").replace("*","×")}}}}}}}function font(inputElem){var lengthElem=inputElem.value.length;if(lengthElem>11){inputElem.classList.add("font-min")}if(lengthElem>16){inputElem.classList.remove("font-min");inputElem.classList.add("font-micro")}if(lengthElem<=11){inputElem.classList.remove("font-min");inputElem.classList.remove("font-micro")}}